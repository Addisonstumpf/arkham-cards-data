{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "definitions": {
    "cardQuery": {
      "$id": "#cardQuery",
      "type": "object",
      "properties": {
        "trait": {
          "type": "string"
        },
        "unique": {
          "type": "boolean"
        },
        "code": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "choice": {
      "$id": "#choice",
      "type": "object",
      "properties": {
        "text": {
          "type": "string"
        },
        "effects": {
          "type": "array",
          "items": {
            "$ref": "#effect"
          }
        }
      },
      "required": ["text", "effects"]
    },
    "cardChoiceInput": {
      "$id": "#cardChoiceInput",
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "card_choice"
          ]
        },
        "query": {
          "oneOf": [
            {
              "$ref": "#cardQuery"            
            },
            {
              "type": "array",
              "items": {
                "$ref": "#cardQuery"
              }
            }
          ]
        },
        "choices": {
          "type": "array",
          "items": {
            "$ref": "#choice"
          }
        }
      },
      "required": ["type", "query", "choices"],
      "additionalProperties": false
    },
    "chooseInput": {
      "$id": "#chooseInput",
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "choose_one",
            "choose_many"
          ]
        },
        "choices": {
          "type": "array",
          "items": {
            "$ref": "#choice"
          }
        }
      },
      "required": ["type", "choices"],
      "additionalProperties": false
    },
    "counterInput": {
      "$id": "#counterInput",
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "counter"
          ]
        },
        "text": {
          "type": "string",
        },
        "effects": {
          "type": "array",
          "items": {
            "$ref": "#effect"
          }
        }
      },
      "required": ["type", "text", "effects"],
      "additionalProperties": false
    },
    "input": {
      "$id": "#input",
      "oneOf": [
        {
          "$ref": "#cardChoiceInput"
        },
        {
          "$ref": "#chooseInput"
        },
        {
          "$ref": "#counterInput"
        }
      ]
    },
    "inputStep": {
      "$id": "#inputStep",
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
        },
        "text": {
          "type": "string",
        },
        "subtext": {
          "type": "string"
        },
        "input": {
          "$ref": "#input"
        }
      },
      "required": ["id", "input"],
      "additionalProperties": false
    },
    "traumaCondition": {
      "$id": "#traumaCondition",
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "trauma"
          ]
        },          
        "investigator": {
          "$ref": "#investigator"
        },
        "killed": {
          "type": "boolean"
        }
      },
      "required": [
        "type",
        "investigator",
        "id"
      ],
      "additionalProperties": false
    },
    "scenarioDataCondition": {
      "$id": "#scenarioDataCondition",
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "scenario_data"
          ]
        },
        "id": {
          "type": "string",
          "enum": [
            "player_count"
          ]
        }
      },
      "required": [
        "type",
        "id"
      ],
      "additionalProperties": false
    },
    "campaignDataCondition": {
      "$id": "#campaignDataCondition",
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "check_campaign_data"
          ]
        },
        "setting": {
          "type": "string",
          "enum": [
            "difficulty"
          ]
        }
      },
      "required": [
        "type",
        "setting"
      ],
      "additionalProperties": false
    },
    "scenarioCondition": {
      "$id": "#scenarioCondition",
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "check_scenario"
          ]
        },
        "id": {
          "type": "string"
        }
      },
      "required": [
        "type",
        "id"
      ],
      "additionalProperties": false
    },
    "cardCondition": {
      "$id": "#cardCondition",
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "has_card"
          ]
        },
        "investigator": {
          "$ref": "#investigator"
        },
        "card": {
          "type": "string"
        }
      },
      "required": [
        "type",
        "card"
      ],
      "additionalProperties": false
    },
    "campaignLogCondition": {
      "$id": "#campaignLogCondition",
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "check_campaign_log"
          ]
        },
        "section": {
          "type": "string"
        },
        "id": {
          "type": "string"
        }
      },
      "required": [
        "type",
        "section",
        "id"
      ],
      "additionalProperties": false
    },
    "condition": {
      "$id": "#condition",
      "oneOf": [
        {
          "$ref": "#campaignLogCondition"
        },
        {
          "$ref": "#cardCondition"
        },
        {
          "$ref": "#campaignDataCondition"
        },
        {
          "$ref": "#scenarioDataCondition"
        },
        {
          "$ref": "#traumaCondition"
        },
        {
          "$ref": "#scenarioCondition"
        }
      ]
    },   
    "option": {
      "$id": "#option",
      "type": "object",
      "properties": {
        "condition": {
          "type": [
            "string",
            "number",
            "boolean"
          ]
        },
        "effects": {
          "type": "array",
          "items": {
            "$ref": "#effect"
          }
        },
        "step": {
          "type": "string"
        }
      },
      "required": [
        "condition"
      ],
      "additionalProperties": false
    },
    "branchStep": {
      "$id": "#branchStep",
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "type": {
          "type": "string",
          "enum": [
            "branch"
          ]
        },
        "condition": {
          "$ref": "#condition"
        },
        "options": {
          "type": "array",
          "items": {
            "$ref": "#option"
          }
        }
      },
      "required": [
        "id",
        "type",
        "condition",
        "options"
      ],
      "additionalProperties": false
    },     
    "encounterSetsStep": {
      "$id": "#encounterSetsStep",
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "type": {
          "type": "string",
          "enum": [
            "encounter_sets"
          ]
        },
        "text": {
          "type": "string"
        },
        "subtext": {
          "type": "string"
        },
        "encounter_sets": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "type",
        "encounter_sets"
      ],
      "additionalProperties": false
    },    
    "investigator": {
      "$id": "#investigator",
      "type": "string",
      "enum": ["lead_investigator", "all", "any", "choice", "defeated"]
    },
    "earnXpEffect": {
      "$id": "#earnXpEffect",
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "earn_xp"
          ]
        },
        "investigator": {
          "$ref": "#investigator"
        },
        "bonus": {
          "type": "number"
        }
      },
      "required": [
        "type",
        "investigator"        
      ],
      "additionalProperties": false
    },
    "addCardEffect": {
      "$id": "#addCardEffect",
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "add_card"
          ]
        },
        "investigator": {
          "$ref": "#investigator"
        },
        "card": {
          "type": "string"
        },
        "weakness_traits": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "type",
        "investigator",
        "card"
      ],
      "additionalProperties": false
    },
    "campaignDataEffect": {
      "$id": "#campaignDataEffect",
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "campaign_data"
          ]
        },
        "setting": {
          "type": "string",
          "enum": [
            "result",
            "next_scenario"
          ]
        },
        "value": {
          "type": "string",
        }
      },
      "required": [
        "type",
        "setting",
        "value"
      ],
      "additionalProperties": false
    }, 
    "addChaosTokenEffect": {
      "$id": "#addChaosTokenEffect",
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "add_chaos_token"
          ]
        },
        "values": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "+1",
              "0",
              "-1",
              "-2",
              "-3",
              "-4",
              "-5",
              "-6",
              "-7",
              "-8",
              "skull",
              "cultist",
              "tablet",
              "elder_thing",
              "elder_sign",
              "autofail"
            ]
          }
        },
      },
      "required": [
        "type",
        "values"
      ],
      "additionalProperties": false
    }, 
    "campaignLogEffect": {
      "$id": "#campaignLogEffect",
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "campaign_log"
          ]
        },
        "section": {
          "type": "string"
        },
        "id": {
          "type": "string"
        },
        "text": {
          "type": "string"
        },
        "cross_out": {
          "type": "boolean"
        }
      },
      "required": [
        "type",
        "section"
      ],
      "additionalProperties": false
    },     
    "removeCardEffect": {
      "$id": "#removeCardEffect",
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "remove_card"
          ]
        },
        "investigator": {
          "$ref": "#investigator"
        },
        "card": {
          "type": "string"
        }
      },
      "required": [
        "type"
      ],
      "additionalProperties": false
    }, 
    "traumaEffect": {
      "$id": "#traumaEffect",
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "trauma"
          ]
        },
        "investigator": {
          "$ref": "#investigator"
        },
        "mental": {
          "type": "number"
        },
        "physical": {
          "type": "number"
        },
        "killed": {
          "type": "boolean"
        },
        "insane": {
          "type": "boolean"
        }
      },
      "required": [
        "type",
        "investigator"
      ],
      "additionalProperties": false
    }, 
    "effect": {
      "$id": "#effect",
      "oneOf": [
        { "$ref": "#earnXpEffect" },
        { "$ref": "#addCardEffect" },
        { "$ref": "#removeCardEffect" },
        { "$ref": "#traumaEffect" },
        { "$ref": "#campaignLogEffect" },
        { "$ref": "#campaignDataEffect" },
        { "$ref": "#addChaosTokenEffect" },
      ]
    },
    "resolution": {
      "$id": "#resolution",
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "title": {
          "type": "string"
        },
        "text": {
          "type": "string"
        },
        "resolution": {
          "type": "string"
        },
        "steps": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id"
      ],
      "additionalProperties": false
    },
    "genericStep": {
      "$id": "#genericStep",
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "type": {
          "type": "string",
          "enum": [
            "story",
            "rule_reminder"
          ]
        },
        "text": {
          "type": "string"
        },
        "title": {
          "type": "string"
        },
        "effects": {
          "type": "array",
          "items": {
            "$ref": "#effect"
          }
        },
        "steps": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "bullets": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "text": {
                "type": "string"
              }
            },
            "required": ["text"],
            "additionalProperties": false
          }
        }
      },
      "required": [
        "id"
      ],
      "additionalProperties": false
    }
  },
  "properties": {
    "scenarioName": {
      "type": "string"
    },
    "setup": {
      "type": "array",
      "items": {
        "type": "string"
      }
    },
    "resolutions": {
      "type": "array",
      "items": {
        "$ref": "#resolution"
      }
    },
    "steps": {
      "type": "array",
      "items": {
        "oneOf": [
          {
            "$ref": "#branchStep"
          },
          {
            "$ref": "#inputStep"
          },
          {
            "$ref": "#encounterSetsStep"
          },
          {
            "$ref": "#genericStep"
          }
        ]
      }
    },
    "interlude": {
      "type": "boolean"
    }
  },
  "required": [
    "scenarioName",
    "setup",
    "steps"
  ],
  "additionalProperties": false
}